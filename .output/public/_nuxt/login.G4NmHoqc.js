import{u as E,r as f,o as a,c,a as s,v as h,F as I,x as D,t as g,y as M,z as R,A as V,B as L,C as A,d as S,D as F,E as q,G as P,s as k,w as $,b as B,H as U,I as j}from"./entry.rIlh_XXL.js";const G={class:"card"},Y={class:"card-body"},z={key:0,class:"alert alert-danger",role:"alert"},J={class:"mb-0"},K={class:"form_container"},Q={class:"mb-3"},W=s("label",{class:"form-label"},"شماره موبایل",-1),X={type:"submit",class:"btn btn-primary btn-auth"},Z={key:0,class:"spinner-border spinner-border-sm ms-2"},tt={__name:"Login",emits:["showCheckOtpForm"],setup(r,{emit:o}){const l=o,i=E(),t=f([]),e=f(""),_=f(!1);async function p(){const n=/^(\+98|0)?9\d{9}$/;if(e.value==""||!n.test(e.value)){i.error("فرمت شماره موبایل معتبر نمی باشد");return}try{_.value=!0;const u=await $fetch("/api/auth/login",{method:"POST",body:{cellphone:e.value}});i.success("کد ورود برای شما ارسال شد"),l("showCheckOtpForm")}catch(u){t.value=Object.values(u.data.data.message).flat()}finally{_.value=!1}}return(n,u)=>(a(),c("div",G,[s("div",Y,[h(t).length>0?(a(),c("div",z,[s("ul",J,[(a(!0),c(I,null,D(h(t),(d,m)=>(a(),c("li",{key:m},g(d),1))),128))])])):M("",!0),s("div",K,[s("form",{onSubmit:R(p,["prevent"])},[s("div",Q,[W,V(s("input",{"onUpdate:modelValue":u[0]||(u[0]=d=>A(e)?e.value=d:null),type:"text",class:"form-control",id:"cellphone"},null,512),[[L,h(e)]])]),s("button",X,[h(_)?(a(),c("div",Z)):M("",!0),S(" ورود ")])],32)])])]))}},et=F({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(r,{slots:o,attrs:l}){const i=f(!1);return q(()=>{i.value=!0}),t=>{var n;if(i.value)return(n=o.default)==null?void 0:n.call(o);const e=o.fallback||o.placeholder;if(e)return e();const _=t.fallback||t.placeholder||"",p=t.fallbackTag||t.placeholderTag||"span";return c(p,l,_)}}});/*! vue-countdown v2.1.2 | (c) 2018-present Chen Fengyuan | MIT */const v=1e3,b=60*v,y=60*b,O=24*y,T="abort",C="end",x="progress",N="start",w="visibilitychange";var st=F({name:"VueCountdown",props:{autoStart:{type:Boolean,default:!0},emitEvents:{type:Boolean,default:!0},interval:{type:Number,default:1e3,validator:r=>r>=0},now:{type:Function,default:()=>Date.now()},tag:{type:String,default:"span"},time:{type:Number,default:0,validator:r=>r>=0},transform:{type:Function,default:r=>r}},emits:[T,C,x,N],data(){return{counting:!1,endTime:0,totalMilliseconds:0,requestId:0}},computed:{days(){return Math.floor(this.totalMilliseconds/O)},hours(){return Math.floor(this.totalMilliseconds%O/y)},minutes(){return Math.floor(this.totalMilliseconds%y/b)},seconds(){return Math.floor(this.totalMilliseconds%b/v)},milliseconds(){return Math.floor(this.totalMilliseconds%v)},totalDays(){return this.days},totalHours(){return Math.floor(this.totalMilliseconds/y)},totalMinutes(){return Math.floor(this.totalMilliseconds/b)},totalSeconds(){return Math.floor(this.totalMilliseconds/v)}},watch:{$props:{deep:!0,immediate:!0,handler(){this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.autoStart&&this.start()}}},mounted(){document.addEventListener(w,this.handleVisibilityChange)},beforeUnmount(){document.removeEventListener(w,this.handleVisibilityChange),this.pause()},methods:{start(){this.counting||(this.counting=!0,this.autoStart||(this.totalMilliseconds=this.time,this.endTime=this.now()+this.time),this.emitEvents&&this.$emit(N),document.visibilityState==="visible"&&this.continue())},continue(){if(!this.counting)return;const r=Math.min(this.totalMilliseconds,this.interval);if(r>0){let o,l;const i=t=>{o||(o=t),l||(l=t);const e=t-o;e>=r||e+(t-l)/2>=r?this.progress():this.requestId=requestAnimationFrame(i),l=t};this.requestId=requestAnimationFrame(i)}else this.end()},pause(){cancelAnimationFrame(this.requestId)},progress(){this.counting&&(this.update(),this.emitEvents&&this.totalMilliseconds>0&&this.$emit(x,{days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}),this.continue())},abort(){this.counting&&(this.pause(),this.counting=!1,this.emitEvents&&this.$emit(T))},end(){this.counting&&(this.pause(),this.totalMilliseconds=0,this.counting=!1,this.emitEvents&&this.$emit(C))},update(){this.counting&&(this.totalMilliseconds=Math.max(0,this.endTime-this.now()))},restart(){this.pause(),this.totalMilliseconds=this.time,this.endTime=this.now()+this.time,this.counting=!1,this.start()},handleVisibilityChange(){switch(document.visibilityState){case"visible":this.update(),this.continue();break;case"hidden":this.pause();break}}},render(){return P(this.tag,this.$slots.default?[this.$slots.default(this.transform({days:this.days,hours:this.hours,minutes:this.minutes,seconds:this.seconds,milliseconds:this.milliseconds,totalDays:this.totalDays,totalHours:this.totalHours,totalMinutes:this.totalMinutes,totalSeconds:this.totalSeconds,totalMilliseconds:this.totalMilliseconds}))]:void 0)}});const it={class:"d-flex align-items-center"},nt={key:0,class:"mt-3 me-3"},ot={__name:"resendOtp",emits:["resendOtpErrors"],setup(r,{emit:o}){const l=E(),i=f(!1),t=o,e=f(!1);function _(n){const u={};return Object.entries(n).forEach(([d,m])=>{u[d]=m<10?`0${m}`:String(m)}),u}async function p(){try{i.value=!0,$fetch("/api/auth/resendOtp",{method:"POST"}),l.success("کد جدید ارسال شد")}catch(n){t("resendOtpErrors",Object.values(n.data.data.message).flat())}finally{i.value=!1}}return(n,u)=>{const d=et;return a(),k(d,null,{default:$(()=>[s("div",it,[h(e)?(a(),c("button",{key:1,loading:"loading",onClick:p,class:"btn btn-dark"}," ارسال دوباره ")):(a(),c("div",nt,[B(h(st),{time:20*1e3,transform:_,onEnd:u[0]||(u[0]=m=>e.value=!0)},{default:$(({minutes:m,seconds:H})=>[S(g(H)+" : "+g(m),1)]),_:1})]))])]),_:1})}}},at={class:"card"},lt={class:"card-body"},rt={key:0,class:"alert alert-danger",role:"alert"},ct={class:"mb-0"},ut={class:"form_container"},dt={class:"mb-3"},ht=s("label",{class:"form-label"},"کد ورود",-1),mt={class:"d-flex align-items justify-content-between"},ft={key:0,class:"spinner-border spinner-border-sm ms-2"},_t={__name:"checkOtp",setup(r){const{authUser:o}=U(),l=E(),i=f([]),t=f(""),e=f(!1);async function _(){if(t.value==null){l.error("کد تایید الزامی است");return}if(!/^[0-9]{6}$/.test(t.value)){l.error("فرمت کد تایید صحیح نیست");return}try{e.value=!0;const n=await $fetch("/api/auth/checkOtp",{method:"POST",body:{otp:t.value}});return l.success("با موفقیت وارد شدید"),o.value=n,j("/")}catch(n){i.value=Object.values(n.data.data.message).flat()}finally{e.value=!1}}return(p,n)=>{const u=ot;return a(),c("div",at,[s("div",lt,[h(i).length>0?(a(),c("div",rt,[s("ul",ct,[(a(!0),c(I,null,D(h(i),(d,m)=>(a(),c("li",{key:m},g(d),1))),128))])])):M("",!0),s("div",ut,[s("div",dt,[ht,V(s("input",{"onUpdate:modelValue":n[0]||(n[0]=d=>A(t)?t.value=d:null),type:"text",class:"form-control",id:"cellphone"},null,512),[[L,h(t)]])]),s("div",mt,[s("button",{onClick:_,type:"submit",class:"btn btn-primary btn-auth"},[h(e)?(a(),c("div",ft)):M("",!0),S(" تایید ")]),B(u,{onResendOtpErrors:n[1]||(n[1]=d=>i.value=d)})])])])])}}},pt={class:"auth_section book_section"},vt={class:"container"},bt={class:"row mt-5"},yt={class:"col-md-4 offset-md-4"},Mt={__name:"login",setup(r){const o=f(!1);return(l,i)=>{const t=tt,e=_t;return a(),c("section",pt,[s("div",vt,[s("div",bt,[s("div",yt,[h(o)?(a(),k(e,{key:1})):(a(),k(t,{key:0,onShowCheckOtpForm:i[0]||(i[0]=()=>o.value=!0)}))])])])])}}};export{Mt as default};
